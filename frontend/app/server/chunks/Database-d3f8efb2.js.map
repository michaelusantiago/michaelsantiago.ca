{"version":3,"file":"Database-d3f8efb2.js","sources":["../../../.svelte-kit/adapter-node/chunks/utilities.js","../../../.svelte-kit/adapter-node/chunks/Database.js"],"sourcesContent":["function exactAge(birth_date) {\n  const AVERAGE_DAYS_IN_YEAR = 365.25;\n  const MONTHS_IN_YEAR = 12;\n  const DAYS_IN_WEEK = 7;\n  const AVERAGE_DAYS_IN_MONTH = AVERAGE_DAYS_IN_YEAR / MONTHS_IN_YEAR;\n  const MS_IN_YEAR = 315576e5;\n  const MS_IN_DAY = 864e5;\n  const MS_IN_MONTH = AVERAGE_DAYS_IN_MONTH * MS_IN_DAY;\n  const MS_IN_WEEK = DAYS_IN_WEEK * MS_IN_DAY;\n  const my_bd = new Date(birth_date).getTime();\n  const now = (/* @__PURE__ */ new Date()).getTime();\n  let age_in_ms = now - my_bd;\n  let myAge = { year: 0, months_over: 0, weeks_over: 0, days_over: 0 };\n  myAge.year = Math.trunc(age_in_ms / MS_IN_YEAR);\n  age_in_ms -= myAge.year * MS_IN_YEAR;\n  myAge.months_over = Math.trunc(age_in_ms / MS_IN_MONTH);\n  age_in_ms -= myAge.months_over * MS_IN_MONTH;\n  myAge.weeks_over = Math.trunc(age_in_ms / MS_IN_WEEK);\n  age_in_ms -= myAge.weeks_over * MS_IN_WEEK;\n  myAge.days_over = Math.trunc(age_in_ms / MS_IN_DAY);\n  return myAge;\n}\nconst serializeNonPOJ = (data) => {\n  if (data)\n    return JSON.parse(JSON.stringify(data));\n  return null;\n};\nexport {\n  exactAge as e,\n  serializeNonPOJ as s\n};\n","import { p as public_env } from \"./shared-server.js\";\nimport { s as serializeNonPOJ } from \"./utilities.js\";\nimport PocketBase from \"pocketbase\";\nconst getAdmin = async () => {\n  const pb = new PocketBase(public_env.PUBLIC_PB_URI);\n  return serializeNonPOJ(\n    await pb.collection(\"users\").getFullList(0, { filter: \"role = 0\" })\n  )[0];\n};\nconst signUp = async (user) => {\n  const pb = new PocketBase(public_env.PUBLIC_PB_URI);\n  try {\n    const new_user = await pb.collection(\"users\").create(user);\n    if (new_user)\n      await pb.collection(\"users\").requestVerification(String(user.get(\"email\")));\n    return { success: true };\n  } catch (error) {\n    return {\n      sucesss: false,\n      message: serializeNonPOJ(error.data)\n    };\n  }\n};\nconst post = async (post2) => {\n  const pb = new PocketBase(public_env.PUBLIC_PB_URI);\n  try {\n    await pb.collection(\"posts\").create(post2);\n    return { success: true };\n  } catch (error) {\n    console.log(error);\n    return {\n      err: true,\n      message: serializeNonPOJ(error?.data)\n    };\n  }\n};\nconst deletePost = async (post_id) => {\n  const pb = new PocketBase(public_env.PUBLIC_PB_URI);\n  await pb.collection(\"posts\").delete(post_id);\n};\nconst getChats = async (current_user_id, friend_id) => {\n  const pb = new PocketBase(public_env.PUBLIC_PB_URI);\n  try {\n    const chats = serializeNonPOJ(\n      await pb.collection(\"chats\").getFullList(0, {\n        filter: `(from = \"${current_user_id}\" && to = \"${friend_id}\") || (from = \"${friend_id}\" && to = \"${current_user_id}\")`,\n        sort: \"+created\"\n      })\n    );\n    return { success: true, chats };\n  } catch (err) {\n    console.log(err);\n    return { error: true, message: err.message };\n  }\n};\nconst sendMessage = async (pb, data) => {\n  await pb.collection(\"chats\").create(data);\n};\nconst getUnreadChats = async (user_id) => {\n  const pb = new PocketBase(public_env.PUBLIC_PB_URI);\n  const unread_chats = serializeNonPOJ(\n    await pb.collection(\"chats\").getFullList(0, {\n      filter: `(read = false) && (to = \"${user_id}\")`,\n      sort: \"+created\"\n    })\n  );\n  return unread_chats;\n};\nconst updateChatsRead = async (user_id) => {\n  const pb = new PocketBase(public_env.PUBLIC_PB_URI);\n  const unread_chats = await getUnreadChats(user_id);\n  if (unread_chats.length == 0)\n    return;\n  for (let chat of unread_chats) {\n    await pb.collection(\"chats\").update(chat.id, { read: true });\n  }\n};\nconst updateAdminChatsRead = async (friend_id) => {\n  const pb = new PocketBase(public_env.PUBLIC_PB_URI);\n  const admin = await getAdmin();\n  const unread_chats = serializeNonPOJ(\n    await pb.collection(\"chats\").getFullList(0, {\n      filter: `(from = \"${friend_id}\" && to = \"${admin.id}\") && (read = false)`,\n      sort: \"+created\"\n    })\n  );\n  if (!unread_chats.length)\n    return;\n  for (let chat of unread_chats) {\n    await pb.collection(\"chats\").update(chat.id, { read: true });\n  }\n};\nconst requestResetPassword = async (email) => {\n  const pb = new PocketBase(public_env.PUBLIC_PB_URI);\n  try {\n    const result = await pb.collection(\"users\").requestPasswordReset(email);\n    return { success: true };\n  } catch (error) {\n    console.log(error);\n    return {\n      success: false,\n      message: serializeNonPOJ(error?.data)\n    };\n  }\n};\nexport {\n  getUnreadChats as a,\n  updateAdminChatsRead as b,\n  sendMessage as c,\n  deletePost as d,\n  getChats as e,\n  getAdmin as g,\n  post as p,\n  requestResetPassword as r,\n  signUp as s,\n  updateChatsRead as u\n};\n"],"names":[],"mappings":"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"}